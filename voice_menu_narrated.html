
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>р╕гр╕░р╕Ър╕Ър╕кр╕▒р╣Ир╕Зр╕нр╕▓р╕лр╕▓р╕гр╕Фр╣Йр╕зр╕вр╣Ар╕кр╕╡р╕вр╕З</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #f0f0f0;
      padding: 50px;
    }
    h1 {
      color: #222;
    }
    #status {
      font-size: 1.3em;
      margin-top: 20px;
      color: #007BFF;
    }
    .mic-icon {
      font-size: 80px;
      color: #dc3545;
      margin-top: 40px;
    }
    .instruction {
      font-size: 1em;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>ЁЯОЩя╕П р╕гр╕░р╕Ър╕Ър╕кр╕▒р╣Ир╕Зр╕нр╕▓р╕лр╕▓р╕гр╕Фр╣Йр╕зр╕вр╣Ар╕кр╕╡р╕вр╕З</h1>
  <p class="instruction">р╕Юр╕╣р╕Фр╕зр╣Ир╕▓ "р╣Гр╕Кр╣И" р╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕гр╕┤р╣Ир╕бр╕кр╕▒р╣Ир╕Зр╕нр╕▓р╕лр╕▓р╕г р╣Бр╕ер╣Йр╕зр╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕бр╕Щр╕╣р╕Фр╣Йр╕зр╕вр╣Ар╕кр╕╡р╕вр╕З</p>
  <div class="mic-icon">ЁЯОд</div>
  <p id="status">р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Ф...</p>

  <script>
    const blynkToken = "vd6V8MwWDonxjkjZD-XXx3fKqsidTaDv";

    function speakNarration(type) {
      let text = "";
      switch (type) {
        case "start":
          text = "р╕Др╕╕р╕Ур╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╕кр╕▒р╣Ир╕Зр╕нр╕▓р╕лр╕▓р╕гр╕лр╕гр╕╖р╕нр╣Др╕бр╣И р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕нр╕Ър╕зр╣Ир╕▓ р╣Гр╕Кр╣И р╕лр╕гр╕╖р╕н р╣Др╕бр╣Ир╣Гр╕Кр╣И";
          break;
        case "menu":
          text = "р╣Вр╕Ыр╕гр╕Фр╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕бр╕Щр╕╣р╕нр╕▓р╕лр╕▓р╕гр╕Чр╕╡р╣Ир╕Др╕╕р╕Ур╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕г р╣Ар╕Кр╣Ир╕Щ р╕Хр╣Йр╕бр╕вр╕│р╕Бр╕╕р╣Йр╕З р╕Ьр╕▒р╕Фр╕Бр╕гр╕░р╣Ар╕Юр╕гр╕▓ р╕лр╕гр╕╖р╕н р╣Бр╕Бр╕Зр╕кр╣Йр╕б";
          break;
        case "unknown":
          text = "р╣Др╕бр╣Ир╕гр╕╣р╣Йр╕Ир╕▒р╕Бр╣Ар╕бр╕Щр╕╣р╕Щр╕╡р╣Й р╕Бр╕гр╕╕р╕Ур╕▓р╕Юр╕╣р╕Фр╣Гр╕лр╕бр╣Ир╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З";
          break;
        case "error":
          text = "р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╕Яр╕▒р╕З р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕нр╕кр╕▒р╕Бр╕Др╕гр╕╣р╣Ир╣Бр╕ер╣Йр╕зр╕ер╕нр╕Зр╣Гр╕лр╕бр╣И";
          break;
        case "sent":
          text = "р╕гр╕░р╕Ър╕Ър╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в р╕Бр╕│р╕ер╕▒р╕Зр╕Бр╕ер╕▒р╕Ър╕кр╕╣р╣Ир╣Ар╕бр╕Щр╕╣р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ";
          break;
        default:
          text = type;
      }
      document.getElementById("status").innerText = text;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "th-TH";
      speechSynthesis.speak(utterance);
    }

    function sendToBlynk(pin, menuName) {
      const url = `https://blynk.cloud/external/api/update?token=${blynkToken}&${pin}=1`;
      fetch(url)
        .then(response => {
          if (response.ok) {
            speakNarration("р╕гр╕░р╕Ър╕Ър╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Ар╕бр╕Щр╕╣ " + menuName + " р╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з");
            setTimeout(() => speakNarration("sent"), 1500);
            setTimeout(askToOrder, 4000);
          } else {
            speakNarration("р╕кр╣Ир╕Зр╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И");
            setTimeout(askToOrder, 3000);
          }
        });
    }

    function askToOrder() {
      speakNarration("start");

      const recognition = new webkitSpeechRecognition();
      recognition.lang = "th-TH";
      recognition.interimResults = false;
      recognition.onresult = (event) => {
        const text = event.results[0][0].transcript.toLowerCase();
        if (text.includes("р╣Гр╕Кр╣И")) {
          setTimeout(() => speakNarration("menu"), 1000);
          setTimeout(listenForMenu, 3500);
        } else {
          speakNarration("р╣Др╕бр╣Ир╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Др╕│р╕зр╣Ир╕▓р╣Гр╕Кр╣И р╕Вр╕нр╕Цр╕▓р╕бр╣Гр╕лр╕бр╣Ир╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З");
          setTimeout(askToOrder, 3000);
        }
      };
      recognition.onerror = () => {
        speakNarration("error");
        setTimeout(askToOrder, 3000);
      };
      recognition.start();
    }

    function listenForMenu() {
      const recognition = new webkitSpeechRecognition();
      recognition.lang = "th-TH";
      recognition.interimResults = false;
      recognition.onresult = (event) => {
        const text = event.results[0][0].transcript.toLowerCase();
        document.getElementById("status").innerText = `р╕Др╕╕р╕Ур╕Юр╕╣р╕Фр╕зр╣Ир╕▓: ${text}`;
        const utterance = new SpeechSynthesisUtterance(`р╕Др╕╕р╕Ур╕Юр╕╣р╕Фр╕зр╣Ир╕▓ ${text}`);
        utterance.lang = "th-TH";
        speechSynthesis.speak(utterance);

        if (text.includes("р╕Хр╣Йр╕бр╕вр╕│р╕Бр╕╕р╣Йр╕З")) {
          sendToBlynk("V0", "р╕Хр╣Йр╕бр╕вр╕│р╕Бр╕╕р╣Йр╕З");
        } else if (text.includes("р╕Ьр╕▒р╕Фр╕Бр╕гр╕░р╣Ар╕Юр╕гр╕▓")) {
          sendToBlynk("V1", "р╕Ьр╕▒р╕Фр╕Бр╕гр╕░р╣Ар╕Юр╕гр╕▓");
        } else if (text.includes("р╣Бр╕Бр╕Зр╕кр╣Йр╕б")) {
          sendToBlynk("V2", "р╣Бр╕Бр╕Зр╕кр╣Йр╕б");
        } else {
          setTimeout(() => speakNarration("unknown"), 1500);
          setTimeout(listenForMenu, 3500);
        }
      };
      recognition.onerror = () => {
        speakNarration("error");
        setTimeout(askToOrder, 3000);
      };
      recognition.start();
    }

    window.onload = () => {
      speakNarration("р╕Бр╕│р╕ер╕▒р╕Зр╣Вр╕лр╕ер╕Ф...");
      setTimeout(askToOrder, 2000);
    };
  </script>
</body>
</html>
